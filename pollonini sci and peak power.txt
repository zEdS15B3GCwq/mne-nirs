2. Materials and methods
2.1 Overview

The SNR measure of an optical channel relies on the accepted notion that the photoplethysmographic signal associated with the cardiac cycle (i.e., the pulsatile optical signal related to changes in blood volume at the catchment site) must be detected clearly in order to successfully perform an fNIRS measurement [4]. Since the cardiac pulsation in an fNIRS signal is mainly attributed to blood circulation in the scalp, its prominence provides strong evidence of the effective coupling to the scalp of each of the two optodes forming the fNIRS channel. The advantage of this approach over electrical measures, such as amplitude of the photodetected signals or gain setting of the signal amplifiers, is that it is derived directly from physiological readings and is non-specific to the fNIRS instrumentation being used.

To determine the coupling status of each individual optode in fNIRS headgear, we represented the topology of the optical layout as a connected graph in  which nodes represent the individual optodes and edges represent the optode pairings weighed by their SNR. Graph theory and Boolean algebra were then applied to univocally determine the uncoupled nodes causing low SNR values of their connected edges.

The methodology described in this paper has been implemented in a software tool called PHOEBE (Placing Headgear Optodes Efficiently Before Experimentation). Once an fNIRS geometric layout is loaded into PHOEBE and data acquisition is initiated using the instrument’s software, PHOEBE computes the SNR of each optical channel in real time and displays the coupling status of each optode on a head model, thus providing immediate visual feedback to the experimenter. PHOEBE is freely  available for use by the fNIRS community and is compatible with some fNIRS imaging instruments (NIRx NIRScout and NIRSport). Compatibility adjustments to permit use with more devices can certainly be added in the future.

2.2 Signal-to-noise ratio of fNIRS channels
The signal to noise ratio of an fNIRS optical channel is strongly related to the optical coupling that each of the two optodes (i.e., one light-emitting optode and one light-collecting optode) forming the channel has with the scalp. In our previous work [5], we introduced an SNR measure of an fNIRS channel called scalp coupling index (SCI) that quantified the prominence of the photoplethysmographic cardiac waveform and which is predominantly associated with the pulsatile volume of blood circulating in the scalp. Originally, SCI was implemented to identify optical channels with poor scalp coupling and thus exclude them from further processing. In this paper, we describe a more robust method for SNR estimation that combines the original definition of SCI with additional power features of the photoplethysmographic cardiac signal. Although we validated the SNR measure on signals obtained with a specific continuous-wave fNIRS instrument (NIRSScout, NIRx Medical Technologies, Glen Head, NY), the proposed method is applicable to signals obtained via any commercial or custom-built fNIRS device able to measure photoplethysmographic cardiac signals.

To compute SCI at a certain time point, the pulsatile cardiac waveform must first be separated from the cortical component (i.e., resting or event-related brain hemodynamics) and other systemic components (i.e., respiration, Mayer waves) by band-pass filtering the raw photodetected signals between 0.5 Hz and 2.5 Hz that correspond to a cardiac pulsation between 30 and 150 beats per minute (bpm). A narrower bandwidth could be set depending on the expected heart rate of the individuals being measured. Heart rate normally depends on experimental conditions (e.g., resting vs. physically active subjects) and population features (e.g., age, medical condition, medication intake, etc.). Since the illuminating optode of a given fNIRS channel typically embeds two co-located sources emitting at distinct wavelengths (e.g., 760 nm and 850 nm in the NIRx NIRSScout), the band-pass filter is applied to both photodetected signals xλ1(t–T:t) and xλ2(t–T:t), where T represents a time interval over which SCI is calculated, e.g. the most recent 2 seconds of acquired signals. Although most fNIRS instruments have a data sampling frequency fsampling greater than 5 Hz, the upper cut-off frequency of the band-pass filter is limited by the Shannon-Nyquist sampling theorem (fcut-off ≤ 2·fsampling). The filtered signals are then normalized to their standard deviation (obtaining x'λ1 and x'λ2 ) to reject the difference between the optical power of
sources at wavelengths λ1 and λ2 and the difference between values of the extinction coefficient for oxyhemoglobin (Hb) and deoxyhemoglobin (HbR) at the two wavelengths. Finally, SCI is computed as the zero-lag cross-correlation between the normalized signals, i.e. SCI=x'λ1⊗x'λ2 (0), which estimates the similarity between the signals x'λ1 and x'λ2.

Critically, SCI is affected by the specific wavelengths used to measure optical absorptions. While several fNIRS instruments use the shorter of the two light wavelengths in the mid-range of the NIRS spectrum [1] (e.g., NIRx NIRScout: 760 nm, OXYMON MK-III: 760 nm, Spectratech OEG-SpO2: 770 nm, Shimatzu FOIRE-3000: 780 nm), other devices use a near-visible wavelength [1] (e.g., Rogue Research Brainsight: 685 nm, Techen CW6: 690 nm, ISS Imagent: 690 nm, Hitachi ETG-4000: 695 nm) at which the molar extinction of HbR is substantially higher [6], thus resulting in a weaker photodetected signal. Since the cardiac component of an fNIRS signal is mostly associated with blood volume changes in the arterial compartment where the fraction of HbR is significantly lower than the fraction of HbO, the cardiac signal measured using near-visible wavelengths (e.g., 685-705 nm) is usually noisier than the cardiac signal measured using longer wavelengths (e.g., 760-780 nm). Previously, we used an SCI threshold of 0.8 to identify channels with acceptable scalp coupling [5,7]. However, when the scalp coupling is ideal, fNIRS instruments often exhibit an SCI that approaches the maximum value of 1.

SCI is also affected by signal artifacts caused by movements of the head or the jaw. These artifacts typically introduce spikes or step-like signal changes whose magnitude is larger than the peak-to-peak amplitude of the cardiac pulsation and which are simultaneously and synchronously present in both optical signals xλ1 and xλ2, thus yielding a high SCI that falsely indicates a clean signal. To improve the robustness of a quantitative scalp coupling measure even in the presence of such movement artifacts, we used the spectral power of the cross-correlated signal as an additional estimator of the strength of the cardiac signal. Specifically, a clean optical channel can be objectively distinguished from a noisy optical channel using a spectral power threshold. In theory, photodetected cardiac signals can be modeled with two purely sinusoidal waves xλ1 and xλ2 oscillating at a physiological frequency fcardiac (e.g., 1 Hz, or 60 bpm) and having arbitrary amplitude and offset. The resulting normalized cross-correlation signal x'λ1 ⊗ x'λ2 has unity amplitude, frequency fcardiac and peak power of 0.5. Thus, a threshold could be set at a certain fraction of the ideal peak power. In reality, cardiac photoplethysmographic signals are not purely sinusoidal and they often bear quantization noise that decreases the peak value of power, hence the threshold value that we recommend is set empirically at 0.1, as is shown in the Results section.